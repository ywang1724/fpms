"use strict";var ApplicationConfiguration=function(){var a="fpms",b=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","datatables","datatables.bootstrap","datatables.scroller","mgcrea.ngStrap","ngLocale","highcharts-ng","ngClipboard","angularModalService","oitozero.ngSweetAlert"],c=function(b,c){angular.module(b,c||[]),angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("apps"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("mails"),ApplicationConfiguration.registerModule("users"),angular.module("apps").run(["Menus",function(a){a.addMenuItem("topbar","我的应用","apps","dropdown","/apps(/create)?","false",["user"]),a.addSubMenuItem("topbar","apps","应用列表","apps"),a.addSubMenuItem("topbar","apps","添加应用","apps/create"),a.addMenuItem("topbar","应用列表","apps","item","/apps","false",["admin"])}]),angular.module("apps").config(["$datepickerProvider",function(a){angular.extend(a.defaults,{animation:"am-flip-x",autoclose:!0,dateType:"number"})}]),angular.module("apps").config(["$selectProvider",function(a){angular.extend(a.defaults,{animation:"am-flip-x"})}]),angular.module("apps").config(["$tooltipProvider",function(a){angular.extend(a.defaults,{animation:"am-flip-x",trigger:"hover",placement:"bottom",type:"success"})}]),angular.module("apps").config(["ngClipProvider",function(a){a.setPath("lib/zeroclipboard/dist/ZeroClipboard.swf")}]),angular.module("apps").config(["$stateProvider",function(a){a.state("listApps",{url:"/apps",templateUrl:"modules/apps/views/app/list-apps.client.view.html"}).state("createApp",{url:"/apps/create",templateUrl:"modules/apps/views/app/create-app.client.view.html"}).state("editApp",{url:"/apps/:appId/edit",templateUrl:"modules/apps/views/app/edit-app.client.view.html"}).state("viewApp",{url:"/apps/:appId",templateUrl:"modules/apps/views/app/view-app.client.view.html"}).state("viewAppPerformance",{url:"/apps/performance/:appId",templateUrl:"modules/apps/views/performance/view-performance.client.view.html"}).state("viewAppException",{url:"/apps/exception/:appId",templateUrl:"modules/apps/views/exception/view-exception.client.view.html"})}]),angular.module("apps").controller("AppsController",["$scope","$stateParams","$location","Authentication","Apps","DTOptionsBuilder","$http","$timeout","PageService","SweetAlert",function(a,b,c,d,e,f,g,h,i,j){a.authentication=d,a.type="java",a.types=["java","node.js","android","ios"],a.deadLinkInterval=36e5,a.deadLinkIntervals=[{label:"30分钟",value:18e5},{label:"1个小时",value:36e5},{label:"半天",value:432e5},{label:"1天",value:864e5},{label:"1周",value:6048e5},{label:"1个月",value:2592e6}],a.alarmInterval=9e5,a.alarmIntervals=[{label:"5分钟",value:3e5},{label:"10分钟",value:6e5},{label:"15分钟",value:9e5},{label:"30分钟",value:18e5},{label:"1个小时",value:36e5},{label:"半天",value:432e5},{label:"1天",value:864e5},{label:"1周",value:6048e5},{label:"1个月",value:2592e6}],a.alarmtype=[1,2,3,4],a.alarmtypes=[{label:"JavaScript异常",value:1,checked:!0},{label:"Ajax请求异常",value:2,checked:!0},{label:"静态资源请求异常",value:3,checked:!0},{label:"死链接异常",value:4,checked:!0},{label:"页面加载异常",value:5,checked:!1},{label:"DOM结构异常",value:6,checked:!1},{label:"内存异常",value:7,checked:!1}],a.toggleSelection=function(b,c){var d=parseInt(b.target.value);b.target.checked?1===c?a.typekind.push(d):a.app.alarmtype.push(d):1===c?a.alarmtype.splice(a.alarmtype.indexOf(d),1):a.app.alarmtype.splice(a.app.alarmtype.indexOf(d),1)},d.user&&(a.showName="admin"===d.user.roles[0]?!0:!1),a.script='<script type="text/javascript" id="feException" src="http://'+c.host()+":"+c.port()+"/bookie.js/"+b.appId+'"></script>',a.create=function(){var b=new e({name:this.name,type:this.type,host:this.host,deadLinkInterval:this.deadLinkInterval,alarmtype:this.alarmtype,alarmInterval:this.alarmInterval,alarmEmail:this.alarmEmail});b.$save(function(b){c.path("apps/"+b._id),a.name="",a.type="java",a.host="",a.alarmtype=[1,2,3,4],a.deadLinkInterval=36e5,a.alarmInterval=9e5,a.alarmEmail=""},function(b){a.error=b.data.message})},a.remove=function(b){j.swal({title:"确定删除该应用?",text:"应用删除后不可恢复哟!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定，删掉它!",cancelButtonText:"不删，考虑一下!",closeOnConfirm:!1,closeOnCancel:!1},function(d){if(d)if(b){b.$remove();for(var e in a.apps)a.apps[e]===b&&a.apps.splice(e,1);j.swal("删除成功!","该页面已被成功删除.","success")}else j.swal("删除成功!","该页面已被成功删除.","success"),a.app.$remove(function(){c.path("apps")});else j.swal("删除取消!","该应用仍然存在 :)","error")})},a.update=function(){var b=a.app;b.$update(function(){c.path("apps/"+b._id)},function(b){a.error=b.data.message})},a.find=function(){a.apps=e.query()},a.intApp=function(){a.app=e.get({appId:b.appId}),g.get("pages/"+b.appId).success(function(b){a.pages=b}),a.alarmtypes=[{label:"JavaScript异常",value:1,checked:!1},{label:"Ajax请求异常",value:2,checked:!1},{label:"静态资源请求异常",value:3,checked:!1},{label:"死链接异常",value:4,checked:!1},{label:"页面加载异常",value:5,checked:!1},{label:"DOM结构异常",value:6,checked:!1},{label:"内存异常",value:7,checked:!1}],a.app.$promise.then(function(b){for(var c=0;c<a.app.alarmtype.length;c++){var d=a.app.alarmtype[c];d&&(a.alarmtypes[d-1].checked=!0)}})},a.gotoPerformance=function(b){i.setCurrentPage({_id:b._id,pathname:b.pathname}),i.setIdentifier(2),c.path("apps/performance/"+a.app._id)},a.gotoException=function(b){i.setCurrentPage({_id:b._id,pathname:b.pathname}),i.setIdentifier(2),c.path("apps/exception/"+a.app._id)},a.deletePage=function(b){j.swal({title:"确定删除该页面?",text:"页面删除后不可恢复哟!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定，删掉它!",cancelButtonText:"不删，考虑一下!",closeOnConfirm:!1,closeOnCancel:!1},function(c){c?(j.swal("删除成功!","该页面已被成功删除.","success"),a.pages=a.pages.filter(function(a){return a._id!==b._id}),g["delete"]("pages/"+a.app._id,{params:{pageId:b._id}})):j.swal("删除取消!","该页面仍然存在 :)","error")})},a.canUpdate=function(){return a.appForm.$valid},a.removeErr=function(){a.error=!1},a.back=function(){window.history.back()},a.clip=function(){a.isClip=!0,h(function(){a.isClip=!1},3e3)},a.dtPageOptions=f.newOptions().withLanguage({sLengthMenu:"每页显示 _MENU_ 条数据",sInfo:"从 _START_ 到 _END_ /共 _TOTAL_ 条数据",sInfoEmpty:"没有数据",sInfoFiltered:"(从 _MAX_ 条数据中检索)",sZeroRecords:"没有检索到数据",sSearch:"检索:",oPaginate:{sFirst:"首页",sPrevious:"上一页",sNext:"下一页",sLast:"末页"}}).withBootstrap().withBootstrapOptions({pagination:{classes:{ul:"pagination pagination-sm"}}}).withOption("responsive",!0)}]),angular.module("apps").controller("AppsExceptionController",["$scope","$stateParams","$location","Authentication","Apps","DTOptionsBuilder","$http","$timeout","PageService","ModalService","SweetAlert",function(a,b,c,d,e,f,g,h,i,j,k){a.authentication=d,a.type="java",a.types=["java","node.js","android","ios"],d.user&&(a.showName="admin"===d.user.roles[0]?!0:!1),a.viewException=function(){a.showData=!0,a.app=e.get({appId:b.appId}),g.get("pages/"+b.appId).success(function(b){if(a.pagesNum=b.length||0,b.length){a.showChart=!0;for(var c=[],d=0;d<b.length;d++)c.push(b[d]._id);a.pages=[{_id:c,pathname:"全部"}].concat(b),2===i.getIdentifier()?a.selectPage=a.pages.filter(function(a){return a._id===i.getCurrentPage()._id})[0]:a.selectPage=a.pages[0],a.staticDay=new Date;var e=function(){g.get("exceptions",{params:{pageId:a.selectPage._id,staticDay:new Date(a.staticDay)}}).success(function(b){if(i.setIdentifier(1),b.data.exceptions.length>=1){a.exceptionPie.series[0].data=b.data.pieData,a.exceptionBrowserBar.series[0].data=b.data.browserData,a.exceptionTrendLine.series[0].data=b.data.trendData[0],a.exceptionTrendLine.series[1].data=b.data.trendData[1],a.exceptions=b.data.exceptions,a.exceptionsAll=b.data.exceptionsAll,a.exceptionKinds=b.data.exceptionKinds,a.osDataObj={},a.osData=[];for(var c=0;c<a.exceptions.length;c++)void 0===a.osDataObj[a.exceptions[c].occurTimeAndUi.ui.os]&&(a.osDataObj[a.exceptions[c].occurTimeAndUi.ui.os]=0),a.osDataObj[a.exceptions[c].occurTimeAndUi.ui.os]++;a.osData=Object.keys(a.osDataObj).map(function(b){return[b,a.osDataObj[b]]}),a.exceptionOsBar.series[0].data=a.osData,a.showData=!0}else a.showData=!1})};a.exceptionTrendLine={options:{chart:{type:"area",marginTop:50,width:$(".tabWidth").width()},legend:{enabled:!0},tooltip:{formatter:function(){return"<h6>"+this.key+"下</h6><br/>异常数目为："+this.y},style:{fontSize:"14px"}},plotOptions:{area:{dataLabels:{enabled:!1}}}},credits:{enabled:!1},xAxis:{categories:["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"]},yAxis:{title:{text:"异常数量"}},series:[{name:"当前异常发生趋势",tooltip:{valueSuffix:" 个"},data:[]},{name:"历史异常情况平均值",tooltip:{valueSuffix:" 个"},data:[]}],title:{text:"异常发生趋势"}},a.exceptionBrowserBar={options:{chart:{type:"column",marginTop:50,width:$(".tabWidth").width()},legend:{enabled:!1},tooltip:{formatter:function(){return"<h6>"+this.key+"下</h6><br/>异常数目为："+this.y},style:{fontSize:"14px"}},plotOptions:{column:{dataLabels:{enabled:!0,formatter:function(){return this.y+"个异常"}}}}},credits:{enabled:!1},xAxis:{categories:["Chrome","FireFox","Internet Explorer","Safari","Opera","其它"],title:{text:"浏览器厂商",align:"high"}},yAxis:{title:{text:"异常数量"}},series:[{name:"异常量",tooltip:{valueSuffix:" 个"},data:[]}],title:{text:"异常浏览器统计概况"}},a.exceptionOsBar={options:{chart:{type:"column",marginTop:50,width:$(".tabWidth").width()},legend:{enabled:!1},tooltip:{formatter:function(){return"<h6>"+this.key+"下</h6><br/>异常数目为："+this.y},style:{fontSize:"14px"}},plotOptions:{column:{dataLabels:{enabled:!0,formatter:function(){return this.y+"个异常"}}}}},credits:{enabled:!1},yAxis:{title:{text:"异常数量"}},xAxis:{type:"category",title:{text:"平台",align:"high"}},series:[{name:"异常量",tooltip:{valueSuffix:" 个"},color:"#8085E9",data:[]}],title:{text:"异常发生平台统计概况"}},a.exceptionPie={options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,marginTop:50,width:$(".tabWidth").width()},tooltip:{pointFormat:"数量为:{point.y},{series.name}: <b>{point.percentage:.1f}%</b>",style:{fontSize:"14px"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}}},credits:{enabled:!1},title:{text:"异常分布图"},series:[{type:"pie",name:"占总异常比率",data:[]}]},a.refrashChart=e,e()}else a.showChart=!1})},a.viewExceptionDetail=function(b){console.log(b);var c=a.pages.filter(function(a){return a._id===b.page})[0];j.showModal({templateUrl:"modules/apps/views/exception/view-exceptionModal.client.view.html",inputs:{title:"异常详情",exception:b,page:c},controller:function(a,b,c,d,e){a.title=c,a.exception=d,a.page=e,a.close=function(a){b(a,200)}}}).then(function(a){a.element.show(),a.close.then(function(a){console.log(a)})})},a.viewExceptionKindDetail=function(b){console.log(b);var c=a.exceptionsAll.filter(function(a){return a._id===b._id}),d=a.app,e=a.authentication,g=a.manualAlarm,h=f.newOptions().withLanguage({sLengthMenu:"每页显示 _MENU_ 条数据",sInfo:"从 _START_ 到 _END_ /共 _TOTAL_ 条数据",sInfoEmpty:"没有数据",sInfoFiltered:"(从 _MAX_ 条数据中检索)",sZeroRecords:"没有检索到数据",sSearch:"检索:",oPaginate:{sFirst:"首页",sPrevious:"上一页",sNext:"下一页",sLast:"末页"}}).withBootstrap().withBootstrapOptions({pagination:{classes:{ul:"pagination pagination-sm"}}}).withOption("responsive",!0).withOption("scrollY",220);j.showModal({templateUrl:"modules/apps/views/exception/view-exceptionKindModal.client.view.html",inputs:{title:"该异常种类发生情况",exceptions:c,dtOptions:h,app:d,authentication:e,manualAlarm:g},controller:function(a,b,c,d,e,f,g,h){a.title=c,a.exceptions=d,a.dtOptions=e,a.app=f,a.authentication=g,a.manualAlarm=h,a.close=function(a){b(a,200)}}}).then(function(a){a.element.show(),a.close.then(function(a){console.log(a)})})},a.changeIsAlarm=function(b){b.isAlarm=1===b.isAlarm?2:1,g.put("exceptions/"+b._id,{exception:b}).then(function(c){a.exceptionKinds.splice(a.exceptionKinds.indexOf(b),1,c.data),k.swal("切换成功！")},function(a){k.swal("切换失败!")})},a.gotoPerformance=function(){"全部"===a.selectPage.pathname?c.path("apps/performance/"+a.app._id):(i.setCurrentPage({_id:a.selectPage._id,pathname:a.selectPage.pathname}),i.setIdentifier(2),c.path("apps/performance/"+a.app._id))},a.manualAlarm=function(b){g.put("mails/alarm/"+b._id,{exception:b,appObj:a.app}).then(function(a){k.swal("报警成功！")},function(a){k.swal("报警失败!")})},a.back=function(){window.history.back()},a.dtOptions=f.newOptions().withLanguage({sLengthMenu:"每页显示 _MENU_ 条数据",sInfo:"从 _START_ 到 _END_ /共 _TOTAL_ 条数据",sInfoEmpty:"没有数据",sInfoFiltered:"(从 _MAX_ 条数据中检索)",sZeroRecords:"没有检索到数据",sSearch:"检索:",oPaginate:{sFirst:"首页",sPrevious:"上一页",sNext:"下一页",sLast:"末页"}}).withBootstrap().withBootstrapOptions({pagination:{classes:{ul:"pagination pagination-sm"}}}).withOption("responsive",!0)}]),angular.module("apps").controller("AppsPerformanceController",["$scope","$stateParams","$location","Authentication","Apps","DTOptionsBuilder","$http","$timeout","PageService",function(a,b,c,d,e,f,g,h,i){a.authentication=d,a.type="java",a.types=["java","node.js","android","ios"],d.user&&(a.showName="admin"===d.user.roles[0]?!0:!1),a.viewPerformance=function(){a.showData=!0,a.app=e.get({appId:b.appId}),Highcharts.setOptions({lang:{contextButtonTitle:"导出",printChart:"打印图表",downloadJPEG:"下载JPEG",downloadPDF:"下载PDF",downloadPNG:"下载PNG",downloadSVG:"下载SVG"},global:{useUTC:!1}}),g.get("pages/"+b.appId).success(function(b){if(a.pagesNum=b.length||0,b.length){a.showChart=!0;for(var c=[],d=0;d<b.length;d++)c.push(b[d]._id);a.pages=[{_id:c,pathname:"全部"}].concat(b),2===i.getIdentifier()?a.selectPage=a.pages.filter(function(a){return a._id===i.getCurrentPage()._id})[0]:a.selectPage=a.pages[0],a.intervals=[{name:"日",id:"day"},{name:"月",id:"month"},{name:"年",id:"year"}],a.selectInterval=a.intervals[0],a.browsers=[{name:"全部",id:"all"},{name:"Internet Explorer",id:"Internet Explorer"},{name:"Chrome",id:"Chrome"},{name:"Android Webkit Browser",id:"Android Webkit Browser"},{name:"Firefox",id:"Firefox"},{name:"Safari",id:"Safari"}],a.selectBrowser=a.browsers[0],a.statistics=[{name:"平均值",id:"mean"},{name:"中位数",id:"median"},{name:"p90",id:"quantile_90"}],a.selectStatistic=a.statistics[0];var e=new Date;a.nowDate=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),a.fromDate=a.nowDate-1296e6,a.untilDate=a.nowDate;var f=function(){a.details=[];var b,c;switch(a.selectInterval.id){case"day":b=a.fromDate,c=a.untilDate+864e5,a.chartConfig.xAxis.tickInterval=864e5,a.chartConfig.xAxis.dateTimeLabelFormats={day:"%m.%d"},a.chartConfig.options.tooltip.xDateFormat="%Y-%m-%d";break;case"month":b=Date.UTC(new Date(a.fromDate).getFullYear(),new Date(a.fromDate).getMonth()),c=Date.UTC(new Date(a.untilDate).getFullYear(),new Date(a.untilDate).getMonth()+1),a.chartConfig.xAxis.tickInterval=24192e5,a.chartConfig.xAxis.dateTimeLabelFormats={month:"%Y.%m"},a.chartConfig.options.tooltip.xDateFormat="%Y.%m";break;case"year":b=Date.UTC(new Date(a.fromDate).getFullYear(),0),c=Date.UTC(new Date(a.untilDate).getFullYear()+1,0),a.chartConfig.xAxis.tickInterval=31104e6,a.chartConfig.xAxis.dateTimeLabelFormats={day:"%Y"},a.chartConfig.options.tooltip.xDateFormat="%Y"}switch(a.selectStatistic.id){case"mean":a.chartConfig.title.text="页面性能总体趋势图（平均值）";break;case"median":a.chartConfig.title.text="页面性能总体趋势图（中位数）";break;case"quantile_90":a.chartConfig.title.text="页面性能总体趋势图（p90）"}g.get("timings",{params:{pageId:a.selectPage._id,fromDate:new Date(b),untilDate:new Date(c),interval:a.selectInterval.id,browser:a.selectBrowser.id,statistic:a.selectStatistic.id}}).success(function(b){i.setIdentifier(1),b.statisticData.sum>0?(a.chartConfig.series[0].data=b.numData,a.chartConfig.series[1].data=b.pageLoadData,a.chartConfig.series[2].data=b.networkData,a.chartConfig.series[3].data=b.backendData,a.chartConfig.series[4].data=b.frontendData,a.chartConfig.series[5].data=b.redirectData,a.chartConfig.series[6].data=b.dnsData,a.chartConfig.series[7].data=b.connectData,a.chartConfig.series[8].data=b.waitingData,a.chartConfig.series[9].data=b.receivingData,a.chartConfig.series[10].data=b.processingData,a.chartConfig.series[11].data=b.contentLoadedData,a.chartConfig.series[12].data=b.onLoadData,a.timingPie.series[0].data=[["网络",b.statisticData.network/b.statisticData.pageLoad*100],["后端",b.statisticData.backend/b.statisticData.pageLoad*100],{name:"前端",y:b.statisticData.frontend/b.statisticData.pageLoad*100,sliced:!0,selected:!0},["其它",(b.statisticData.pageLoad-b.statisticData.network-b.statisticData.backend-b.statisticData.frontend)/b.statisticData.pageLoad*100]],a.timingline.series[0].data=[[1*b.statisticData.dnsTime,1*b.statisticData.dnsTime+1*b.statisticData.dns],[1*b.statisticData.connectTime,1*b.statisticData.connectTime+1*b.statisticData.connect],[1*b.statisticData.requestTime,1*b.statisticData.requestTime+1*b.statisticData.waiting],[1*b.statisticData.receiveTime,1*b.statisticData.receiveTime+1*b.statisticData.receiving],[1*b.statisticData.processTime,1*b.statisticData.processTime+1*b.statisticData.processing],[1*b.statisticData.contentLoadedTime,1*b.statisticData.contentLoadedTime+1*b.statisticData.contentLoaded],[1*b.statisticData.onLoadTime,1*b.statisticData.onLoadTime+1*b.statisticData.onLoad],[0,1*b.statisticData.pageLoadTime]],a.statisticData=b.statisticData,a.showData=!0):a.showData=!1})};a.chartConfig={options:{chart:{width:$(".tabWidth").width()},tooltip:{xDateFormat:"%Y-%m-%d",shared:!0,style:{fontSize:"14px"}},plotOptions:{series:{cursor:"pointer",point:{events:{click:function(){g.get("timings",{params:{pageId:a.selectPage._id,dateNumber:this.category,interval:a.selectInterval.id,browser:a.selectBrowser.id}}).success(function(b){a.details=b.data;for(var c=[],d=[],e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=0;l<b.data.length;l++){var m=Date.parse(b.data[l].created);c.push([m,b.data[l].pageLoad]),g.push([m,b.data[l].waiting]),h.push([m,b.data[l].receiving]),j.push([m,b.data[l].contentLoaded]),d.push([m,b.data[l].redirect]),e.push([m,b.data[l].dns]),f.push([m,b.data[l].connect]),i.push([m,b.data[l].processing]),k.push([m,b.data[l].onLoad])}a.timingArea.series[0].data=c,a.timingArea.series[1].data=d,a.timingArea.series[2].data=e,a.timingArea.series[3].data=f,a.timingArea.series[4].data=g,a.timingArea.series[5].data=h,a.timingArea.series[6].data=i,a.timingArea.series[7].data=j,a.timingArea.series[8].data=k})}}}}}},credits:{enabled:!1},xAxis:{title:{text:"日期",align:"high"},type:"datetime",tickInterval:864e5,dateTimeLabelFormats:{day:"%m.%d",month:"%Y.%m",year:"%Y"}},yAxis:[{title:{text:"耗时（ms）"}},{title:{text:"请求总数",style:{color:Highcharts.getOptions().colors[0]}},labels:{style:{color:Highcharts.getOptions().colors[0]}},allowDecimals:!1,opposite:!0}],series:[{name:"请求总数",type:"column",yAxis:1,data:[]},{name:"总耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"网络耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"后端耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"前端耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"页面跳转耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"DNS查询耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"连接耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"等待响应耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"接收文档耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"DOM处理耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"DOM内容加载耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]},{name:"load事件耗时",type:"spline",tooltip:{valueSuffix:" ms"},data:[]}],title:{text:""}},a.timingPie={options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,marginTop:50,width:$(".tabWidth").width()},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>",style:{fontSize:"14px"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}}},credits:{enabled:!1},title:{text:"页面加载耗时分布图(平均值)"},series:[{type:"pie",name:"占总耗时比率",data:[]}]},a.timingArea={options:{chart:{type:"areaspline",zoomType:"x",marginTop:50,width:$(".tabWidth").width()},plotOptions:{areaspline:{fillOpacity:.5,marker:{enabled:!1}}},tooltip:{xDateFormat:"%Y-%m-%d %H:%M:%S",shared:!0,style:{fontSize:"14px"}}},credits:{enabled:!1},xAxis:{title:{text:"日期",align:"high"},type:"datetime"},yAxis:{title:{text:"耗时（ms）"}},series:[{name:"总耗时",tooltip:{valueSuffix:" ms"},data:[]},{name:"页面跳转耗时",tooltip:{valueSuffix:" ms"},data:[]},{name:"DNS查询耗时",tooltip:{valueSuffix:" ms"},data:[]},{name:"连接耗时",tooltip:{valueSuffix:" ms"},data:[]},{name:"等待响应耗时",tooltip:{valueSuffix:" ms"},data:[]},{name:"接收文档耗时",tooltip:{valueSuffix:" ms"},data:[]},{name:"DOM处理耗时",tooltip:{valueSuffix:" ms"},data:[]},{name:"DOM内容加载耗时",tooltip:{valueSuffix:" ms"},data:[]},{name:"load事件耗时",tooltip:{valueSuffix:" ms"},data:[]}],title:{text:"真实请求趋势图"}},a.timingline={options:{chart:{type:"columnrange",inverted:!0,marginTop:50,width:$(".tabWidth").width()},legend:{enabled:!1},tooltip:{formatter:function(){return"<h6>"+this.key+"</h6><br/><table><tr><td>耗时: </td><td><b>"+(this.point.high-this.point.low).toFixed(2)+" ms</b></td></tr></table>"},style:{fontSize:"14px"}},plotOptions:{columnrange:{dataLabels:{enabled:!0,formatter:function(){return this.y.toFixed(2)+"ms"}}}}},credits:{enabled:!1},xAxis:{categories:["DNS查询","连接","等待响应","接收文档","DOM处理","DOM内容加载","load事件","总耗时"]},yAxis:{title:{text:"时间线（ms）"}},series:[{name:"耗时",tooltip:{valueSuffix:" ms"},data:[]}],title:{text:"加载时间线"}},a.refrashChart=f,f()}else a.showChart=!1})},a.dtOptions=f.newOptions().withLanguage({sLengthMenu:"每页显示 _MENU_ 条数据",sInfo:"从 _START_ 到 _END_ /共 _TOTAL_ 条数据",sInfoEmpty:"没有数据",sInfoFiltered:"(从 _MAX_ 条数据中检索)",sZeroRecords:"没有检索到数据",sSearch:"检索:",oPaginate:{sFirst:"首页",sPrevious:"上一页",sNext:"下一页",sLast:"末页"}}).withBootstrap().withBootstrapOptions({pagination:{classes:{ul:"pagination pagination-sm"}}}).withOption("responsive",!0),a.removeErr=function(){a.error=!1},a.back=function(){window.history.back()},a.findTiming=function(b){g.get("timings/"+b).success(function(b){a.timingData=b,a.resources=b.allResourcesCalc,a.timingErrs=b.errs})},a.gotoException=function(){"全部"===a.selectPage.pathname?c.path("apps/exception/"+a.app._id):(i.setCurrentPage({_id:a.selectPage._id,pathname:a.selectPage.pathname}),i.setIdentifier(2),c.path("apps/exception/"+a.app._id))},a.httpNumTooltip={title:"包括HTML页面请求，CSS文件、JavaScript文件、图片等资源下载及其它网络请求。"},a.dnsTimeTooltip={title:"开始进行DNS查询的时间。"},a.connectTimeTooltip={title:"开始请求连接的时间。"},a.reqTimeTooltip={title:"浏览器开始请求文档时间。"},a.resTimeTooltip={title:"浏览器开始接收文档时间。"},a.parseTimeTooltip={title:"浏览器开始解析HTML文档第一批收到的字节。"},a.reactiveTimeTooltip={title:"浏览器完成解析并且所有HTML和DOM构建完毕的时间点。"},a.DOMReadyTimeTooltip={title:"浏览器触发DOMContentLoaded事件的时间。"},a.ResourcesLoadedTimeTooltip={title:"浏览器完成网页及其所有附属资源下载的时间。"},a.onLoadTimeTooltip={title:"浏览器开始触发load事件的时间。"},a.pageLoadTimeTooltip={title:"浏览器完成页面完全加载时间，包括所有onLoad事件以及相关的动态资源加载完成。"},a.pageLoadTooltip={title:"从页面请求到页面完全加载的时间。"},a.networkTooltip={title:"从发出请求到完成连接建立的时间。"},a.backendTooltip={title:"指收到请求后服务器逻辑处理的时间。"},a.frontendTooltip={title:"从开始解析文档到页面完全加载的时间。"},a.redirectTooltip={title:"页面请求后进行页面跳转所消耗的时间。"},a.dnsTooltip={title:"DNS查询的时间。页面请求会产生一次寻找该页面资源所在主机的DNS查询。在同个域名进行页面切换不会造成新的DNS查询。"},a.connectTooltip={title:"指浏览器和服务器之间建立TCP/IP连接的时间，对于SSL连接包括握手的时间。"},a.waitingTooltip={title:"指从开始请求当前文档到开始接收响应的时间。"},a.receivingTooltip={title:"指开始接收响应到完成收到响应的时间。"},a.DOMProcessingTooltip={title:"指从完成收到响应到文档的readyState变为complete的时间。"},a.DOMContentLoadedTooltip={title:"指从文档的DOMContentLoaded事件被触发到文档的DOMContentLoaded事件完成的时间。"},a.onLoadTooltip={title:"指从文档的load事件被触发到文档的load事件完成的时间。"}}]),angular.module("apps").directive("myConfirmClick",[function(){return{priority:-1,restrict:"A",link:function(a,b,c){b.bind("click",function(a){var b=c.myConfirmClick;b&&!confirm(b)&&(a.stopImmediatePropagation(),a.preventDefault())})}}}]),angular.module("apps").factory("Apps",["$resource",function(a){return a("apps/:appId",{appId:"@_id"},{update:{method:"PUT"}})}]),angular.module("apps").factory("PageService",[function(){var a=null,b=1,c=function(b){a=b},d=function(){return a},e=function(a){b=a},f=function(){return b};return{setCurrentPage:c,getCurrentPage:d,setIdentifier:e,getIdentifier:f}}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function(a,b,c){a.authentication=b,a.isCollapsed=!1,a.menu=c.getMenu("topbar"),a.toggleCollapsibleMenu=function(){a.isCollapsed=!a.isCollapsed},a.$on("$stateChangeSuccess",function(){a.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function(a,b){a.authentication=b}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var a=function(a){if(!a)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var b in a.roles)for(var c in this.roles)if(this.roles[c]===a.roles[b])return!0;return!1};this.validateMenuExistance=function(a){if(a&&a.length){if(this.menus[a])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(a){return this.validateMenuExistance(a),this.menus[a]},this.addMenu=function(b,c,d){return this.menus[b]={isPublic:c||!1,roles:d||this.defaultRoles,items:[],shouldRender:a},this.menus[b]},this.removeMenu=function(a){this.validateMenuExistance(a),delete this.menus[a]},this.addMenuItem=function(b,c,d,e,f,g,h,i){return this.validateMenuExistance(b),this.menus[b].items.push({title:c,link:d,menuItemType:e||"item",menuItemClass:e,uiRoute:f||"/"+d,isPublic:null===g||"undefined"==typeof g?this.menus[b].isPublic:g,roles:null===h||"undefined"==typeof h?this.menus[b].roles:h,position:i||0,items:[],shouldRender:a}),this.menus[b]},this.addSubMenuItem=function(b,c,d,e,f,g,h,i){this.validateMenuExistance(b);for(var j in this.menus[b].items)this.menus[b].items[j].link===c&&this.menus[b].items[j].items.push({title:d,link:e,uiRoute:f||"/"+e,isPublic:null===g||"undefined"==typeof g?this.menus[b].items[j].isPublic:g,roles:null===h||"undefined"==typeof h?this.menus[b].items[j].roles:h,position:i||0,shouldRender:a});return this.menus[b]},this.removeMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)this.menus[a].items[c].link===b&&this.menus[a].items.splice(c,1);return this.menus[a]},this.removeSubMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)for(var d in this.menus[a].items[c].items)this.menus[a].items[c].items[d].link===b&&this.menus[a].items[c].items.splice(d,1);return this.menus[a]},this.addMenu("topbar")}]),angular.module("mails").run(["Menus",function(a){a.addMenuItem("topbar","我的邮件","mails","dropdown","/mails(/create)?"),a.addSubMenuItem("topbar","mails","邮件列表","mails")}]),angular.module("mails").config(["$stateProvider",function(a){a.state("listMails",{url:"/mails",templateUrl:"modules/mails/views/list-mails.client.view.html"}).state("viewMail",{url:"/mails/:mailId",templateUrl:"modules/mails/views/view-mail.client.view.html"})}]),angular.module("mails").controller("MailsController",["$scope","$stateParams","$location","Authentication","Mails","DTOptionsBuilder","ModalService",function(a,b,c,d,e,f,g){a.authentication=d,a.remove=function(b){if(b){b.$remove();for(var d in a.mails)a.mails[d]===b&&a.mails.splice(d,1)}else a.mail.$remove(function(){c.path("mails")})},a.update=function(){var b=a.mail;b.$update(function(){c.path("mails/"+b._id)},function(b){a.error=b.data.message})},a.find=function(){a.mails=e.query()},a.findOne=function(){a.mail=e.get({mailId:b.mailId})},a.viewMail=function(a){g.showModal({templateUrl:"modules/mails/views/view-mail.client.view.html",inputs:{title:"邮件详情",mail:a},controller:function(a,b,c,d){a.title=c,a.mail=d,a.close=function(a){b(a,200)}}}).then(function(a){a.element.show(),a.close.then(function(a){console.log(a)})})},a.dtOptions=f.newOptions().withLanguage({sLengthMenu:"每页显示 _MENU_ 条数据",sInfo:"从 _START_ 到 _END_ /共 _TOTAL_ 条数据",sInfoEmpty:"没有数据",sInfoFiltered:"(从 _MAX_ 条数据中检索)",sZeroRecords:"没有检索到数据",sSearch:"检索:",oPaginate:{sFirst:"首页",sPrevious:"上一页",sNext:"下一页",sLast:"末页"}}).withBootstrap().withBootstrapOptions({pagination:{classes:{ul:"pagination pagination-sm"}}}).withOption("responsive",!0)}]),angular.module("mails").factory("Mails",["$resource",function(a){return a("mails/:mailId",{mailId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","Authentication",function(a,b,c){return{responseError:function(d){switch(d.status){case 401:c.user=null,b.path("signin");break;case 403:}return a.reject(d)}}}])}]),angular.module("users").run(["Menus",function(a){a.addMenuItem("topbar","用户列表","users","item","/users","false",["admin"])}]),angular.module("users").config(["$stateProvider",function(a){a.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"}).state("listUsers",{url:"/users",templateUrl:"modules/users/views/settings/list-users.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function(a,b,c,d){a.authentication=d,a.authentication.user&&c.path("/"),a.signup=function(){b.post("/auth/signup",a.credentials).success(function(b){a.success=!0}).error(function(b){a.error=b.message})},a.signin=function(){b.post("/auth/signin",a.credentials).success(function(b){a.authentication.user=b,c.path("/")}).error(function(b){a.error=b.message})},a.removeErr=function(){a.error=!1}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function(a,b,c,d,e){a.authentication=e,a.authentication.user&&d.path("/"),a.askForPasswordReset=function(){a.success=a.error=null,c.post("/auth/forgot",a.credentials).success(function(b){a.credentials=null,a.success=b.message}).error(function(b){a.credentials=null,a.error=b.message})},a.resetUserPassword=function(){a.success=a.error=null,c.post("/auth/reset/"+b.token,a.passwordDetails).success(function(b){a.passwordDetails=null,e.user=b,d.path("/password/reset/success")}).error(function(b){a.error=b.message})},a.back=function(){window.history.back()}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication","DTOptionsBuilder",function(a,b,c,d,e,f){
a.user=e.user,a.user||c.path("/"),a.updateUserProfile=function(b){if(b){a.success=a.error=null;var c=new d(a.user);c.$update(function(b){a.success=!0,e.user=b},function(b){a.error=b.data.message})}else a.submitted=!0},a.changeUserPassword=function(){a.success=a.error=null,b.post("/users/password",a.passwordDetails).success(function(b){a.success=!0,a.passwordDetails=null}).error(function(b){a.error=b.message})},a.find=function(){a.users=d.query()},a.dtOptions=f.newOptions().withLanguage({sLengthMenu:"每页显示 _MENU_ 条数据",sInfo:"从 _START_ 到 _END_ /共 _TOTAL_ 条数据",sInfoEmpty:"没有数据",sInfoFiltered:"(从 _MAX_ 条数据中检索)",sZeroRecords:"没有检索到数据",sSearch:"检索:",oPaginate:{sFirst:"首页",sPrevious:"上一页",sNext:"下一页",sLast:"末页"}}).withBootstrap(),a.change=function(b){a.success=a.error=null,b.$update(function(){a.success=!0},function(b){a.error=b.data.message})},a.back=function(){window.history.back()}}]),angular.module("users").factory("Authentication",[function(){var a=this;return a._data={user:window.user},a._data}]),angular.module("users").factory("Users",["$resource",function(a){return a("users",{},{update:{method:"PUT"}})}]);